
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>RockPaperScissors</title>
  <meta name="author" content="Morgan Prior">

  
  <meta name="description" content="In ruby some times you want to iterate over an array and remove items that meet certain conditions, if using each the results may be unexpected. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://morganp.github.io/blog/page/22">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="RockPaperScissors" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet' type='text/css'>
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-47010631-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">RockPaperScissors</a></h1>
  
    <h2>LizardSpock</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:morganp.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Latest</a></li>
  <li><a href="/blog/archives">All</a></li>
  <li><a href="/tag">Tags</a></li>
  <li><a href="/license">License</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/ruby-each-or-delete_if/">Ruby Each or Delete_if</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-25T12:38:50+01:00" pubdate data-updated="true">Sep 25<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/ruby-each-or-delete_if/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/ruby-each-or-delete_if/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In ruby some times you want to iterate over an array and remove items that meet certain conditions, if using each the results may be unexpected.</p>

<pre><code>require 'pp'
arr = [1,2,3,4,5,6,7]
pp arr
# =&gt; [1, 2, 3, 4, 5, 6, 7, 8]

arr.each do |x|
   if x &gt; 3
      arr.delete( x )
   end
end
pp arr
# =&gt; [1, 2, 3, 5, 7]
</code></pre>

<p>5 and 7 were above 3 last time I checked, what is happening.<br/>
NB: ^ points to the current item of the iterator.</p>

<pre><code>#    [1,2,3,4,5,6,7,8]
#     ^                 -&gt; 1 fails x &gt; 3
#    [1,2,3,4,5,6,7,8]
#       ^               -&gt; 2 fails x &gt; 3
#    [1,2,3,4,5,6,7,8]
#         ^             -&gt; 3 fails x &gt; 3
#    [1,2,3,4,5,6,7,8]
#           ^           -&gt; 4 true  x &gt; 3, delete
#    [1,2,3,5,6,7,8]    -- Intermidiate Array, before each is incremented
#           ^
#    [1,2,3,5,6,7,8]    -- Number 5 has slipped through the evaluation
#             ^         -&gt; 6 true x &gt; 3, delete
#    [1,2,3,5,7,8]      -- Intermidiate Array
#             ^
#    [1,2,3,5,7,8]      -- Number 7 has slipped through
#               ^       -&gt; 8 true x &gt; 3, delete
#    return [1,2,3,5,7] #Not what we expected from the code.
</code></pre>

<p>Introducing <strong>delete_if</strong></p>

<pre><code>require 'pp'
arr = [1,2,3,4,5,6,7,8,9,10]

arr.delete_if do |x| 
   test = x &gt; 3

   # Do something when not being deleted
   if not test
      puts x
   end
   test
end
pp arr
# =&gt; [1, 2, 3]
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/storing-secret-keys-in-ruby-config-files-an-approach/">Storing Secret Keys in Ruby Config Files an Approach</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-11T19:04:53+01:00" pubdate data-updated="true">Sep 11<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/storing-secret-keys-in-ruby-config-files-an-approach/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/storing-secret-keys-in-ruby-config-files-an-approach/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have for a while wondered about an ideal (good) approach to storing api keys in config files in ruby projects. A few conditions must be met:<br/>
1) A new user must be given clear instructions on what has to be configured (until it is done), with boiler plate to complete.<br/>
2) git must not accidentally let you submit the key.</p>

<p>Gregory Brown steered me towards this setup. Create a config.rb file fill out the template for adding data. Then copy it to config.rb.example and add config.rb to the .gitignore</p>

<pre><code>touch config.rb
#setup template of config.rb
cp config.rb config.rb.example
echo "config.rb" &gt;&gt; .gitignore
git add config.rb.example
</code></pre>

<p>The file requiring the keys can then do something like:</p>

<pre><code>begin
  require "config"
rescue LoadError
  STDERR.puts "You need to create a file called config.rb. See config.rb.example"
exit
</code></pre>

<p>A slightly larger example.<br/>
shorturl.rb</p>

<pre><code>  require 'net/http'
  require 'rubygems'
  require 'json'
  require 'cgi'

  begin 
     require File.dirname(__FILE__) + '/bit_ly_key'
  rescue LoadError
   STDERR.puts "You need to create a file called bit_ly_key.rb. See bit_ly_key.rb.example"
   exit
  end

  module TechNews
     class Shorturl
        def initialize( url=nil )
           bit_ly_keys = TechNews::BitLyKey.new

           ##  url encode
           url ||= "http://amaras-tech.co.uk"
           @long_url = CGI.escape( url )
           payload   = "http://api.bit.ly/v3/shorten?login=#{bit_ly_keys.login}&amp;apiKey=#{bit_ly_keys.apiKey}&amp;longUrl=#{@long_url}&amp;format=json"
           @response = Net::HTTP.get URI.parse(payload)
           @response = JSON.parse( @response )
        end

        def get_shorturl
           return @response["data"]["url"]
        end

     end
  end

  if $0 == __FILE__
     x = TechNews::Shorturl.new()
     puts x.get_shorturl
  end
</code></pre>

<p>bit_ly_key.rb</p>

<pre><code># Register at [1] and get api key [2]
# [1]: http://bit.ly
# [2]: http://bit.ly/a/your_api_key

module TechNews
   class BitLyKey
      attr_reader :login, :apiKey

      def initialize
         @login  = ""
         @apiKey = ""
      end

   end
end
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/remove-sensitive-data-from-git/">Remove Sensitive Data From Git</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-10T04:16:56+01:00" pubdate data-updated="true">Sep 10<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/remove-sensitive-data-from-git/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/remove-sensitive-data-from-git/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://help.github.com/removing-sensitive-data/">Removing Sensitive data from git and eliminate history</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/amazon-drops-ec2-web-service-prices/">Amazon Drops EC2 Web Service Prices</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-09T02:24:49+01:00" pubdate data-updated="true">Sep 9<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/amazon-drops-ec2-web-service-prices/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/amazon-drops-ec2-web-service-prices/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The new <a href="http://aws.amazon.com/ec2/#pricing">EC2-Pricing</a> also includes a new Micro service. This micro service is intended for small apps servicing tens of requests per second.</p>

<p>The standard price (EU) is $0.025 so if it was running 24/7/365 that would be:</p>

<pre><code>(24*365*0.025) = $219 or $18.25/month  
</code></pre>

<p><a href="http://www.webfaction.com/?affiliate=morgy">Webfaction</a> can run the same thing for $9.50 a month, limited to fair use of 80MB memory.</p>

<p>With a 1 year Reserved instance, $54 + $0.01 hourly charge this drops to $11.8/month.</p>

<pre><code>((24*365*0.01)+54)/12 = 11.8
</code></pre>

<p>This could be dropped further with a 3 year Reserved instance.</p>

<pre><code>((24*365*0.01*3)+82)/36 = $9.58/month
</code></pre>

<p>If the web then stays deactivated for half this time (site is country specific or only popular around new article posts) then this could drop the monthly cost down to $5.92</p>

<pre><code>((12*365*0.01*3)+82)/36
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/ruby-regular-expressions-lookahead-lookbehind/">Ruby Regular Expressions Lookahead / Lookbehind</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-07T01:39:28+01:00" pubdate data-updated="true">Sep 7<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/ruby-regular-expressions-lookahead-lookbehind/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/ruby-regular-expressions-lookahead-lookbehind/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently discovered a feature of regular expressions called lookahead. This means for a match the lookahead must exist but it does not become part of the matched string.
NB: (group) print first group with \1</p>

<pre><code>"123456".gsub(/(\d\d\d)/, '\1,')
123,456,
</code></pre>

<p>Now with lookahead</p>

<pre><code>"123456".gsub(/(\d\d\d)(?=\d)/, '\1,')
123,456
</code></pre>

<p>There are 2 types of lookahead</p>

<pre><code>match (?=x)
not-match (?!x)
</code></pre>

<p>Ruby 1.8.x does not support these by default but by using <a href="http://oniguruma.rubyforge.org/">Oniguruma</a> which is the default regex engine in Ruby 1.9.x you can also use lookbehind expressions.</p>

<pre><code>match (?&lt;=x)
not-match (?&lt;!x)
</code></pre>

<p>Example not using lookbehind</p>

<pre><code> "http://h:5/".gsub(/:/,'=&gt;')
 http=&gt;//h=&gt;5/
</code></pre>

<p>With Not lookbehind</p>

<pre><code>"http://h:5/".gsub(/(?&lt;!http):/,'=&gt;')
 http://h=&gt;5/
</code></pre>

<p>More info on <a href="http://www.regular-expressions.info/lookaround.html">Lookarounds</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/ruby-time-save-and-restore-serialise/">Ruby Time Save and Restore (Serialise)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-06T16:25:45+01:00" pubdate data-updated="true">Sep 6<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/ruby-time-save-and-restore-serialise/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/ruby-time-save-and-restore-serialise/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One method to save a time and restore it correctly:</p>

<pre><code>def get_time_run
## File Access based on
## http://rubylearning.com/satishtalim/read_write_files.html

 if File.exists?('time.log') 
   File.open('time.log', 'r') do |f|  
      while line = f.gets  
         @last_run = Time.at(line.to_i)
      end  
   end 
 end
 #Nice default if anything above failed
 @last_run ||= Time.at(0) 
end

def set_run_time
   if File.exists?("run.time")
      File.delete("run.time")
   end
   File.open('time.log', 'w') do |f|  
      f.puts Time.now.to_i  
   end  
end
</code></pre>

<p>Previously I had missed off the to_i but that meant when the time was loaded it was a string representation of it, quite a bit trickier to convert back into a time object.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/mac-os-x-harddrive-spin-down-time/">Mac OS X Harddrive Spin Down Time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-01T13:05:32+01:00" pubdate data-updated="true">Sep 1<span>st</span>, 2010</time>
        
           | <a href="/blog/tech/mac-os-x-harddrive-spin-down-time/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/mac-os-x-harddrive-spin-down-time/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The Preferences menu in OS x give you the option to turn off Hard Disks whenever possible to save power however the default 10 minutes idle before shutdown can not be adjusted from this panel. This could also be causing excessive ware on desktop 3.5&#8221; drives.</p>

<p>If you have the developer tools installed then you should have the SpindownHD tool. located in /Developer &ndash;> Applications &ndash;> Performance Tools &ndash;> CHUD &ndash;> Hardware</p>

<p>If you do not have the developer tools installed there is no need just for this tool the changes can be made manually be editing: Library &ndash;> Preferences &ndash;> SystemConfiguration &ndash;> com.apple.PowerManagement.plist
under &lsquo;Disk Sleep Timer&rsquo; adjust the minutes of idle time before shutting drives down.</p>

<p><a href="http://hints.macworld.com/article.php?story=20050601044914357">source1</a>
<a href="http://hints.macworld.com/article.php?story=20060922231408751">source2</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/mac-os-x-default-path/">Mac OS X Default Path</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-26T09:36:06+01:00" pubdate data-updated="true">Aug 26<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/mac-os-x-default-path/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/mac-os-x-default-path/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As this seemed to be a useful post on my old blog I am reposting it.
Just in case the $PATH terminal variable gets corrupted, for MAC OS X 10.5. 10.6.</p>

<pre><code>export PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin
</code></pre>

<p>to add to you path</p>

<pre><code>export PATH=$PATH:/usr/local/sbin:/usr/local/bin
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/error-nomethoderror-undefined-method-%60compact-for-nilnilclass/">Error: NoMethodError: Undefined Method `compact&#8217; for nil:NilClass</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-21T07:20:40+01:00" pubdate data-updated="true">Aug 21<span>st</span>, 2010</time>
        
           | <a href="/blog/tech/error-nomethoderror-undefined-method-%60compact-for-nilnilclass/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/error-nomethoderror-undefined-method-%60compact-for-nilnilclass/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When running a sequel migration I kept getting this error: <br/>
<strong>Error: NoMethodError: undefined method `compact&#8217; for nil:NilClass</strong></p>

<p>My setup looked like this:</p>

<pre><code>./db/data.db
./db/migrate/001-Create_table.rb
</code></pre>

<p>The failing command</p>

<pre><code>$ sequel -m ./db/migrate/ -M 1 sqlite://db/data.db
</code></pre>

<p>The error in this instance was caused by having &lsquo;&ndash;&rsquo; in the file name of the migration. To fix this I changed to:</p>

<pre><code>./db/data.db
./db/migrate/001_Create_table.rb
</code></pre>

<p>Some <a href="http://github.com/morganp/Code-Dojo/tree/master/ORM">ORM active record and sequels lessons I prepared earlier</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/basic-grep-usage/">Basic Grep Usage</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-20T07:20:22+01:00" pubdate data-updated="true">Aug 20<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/basic-grep-usage/#disqus_thread"
             data-disqus-identifier="http://morganp.github.io/blog/tech/basic-grep-usage/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Grep is a unix (and mac os x) command line tool to search files for text.<br/>
1) Search for all files containing &lsquo;text&rsquo; in current directory.</p>

<pre><code>grep text *
</code></pre>

<p>2) Addline number to found matches.</p>

<pre><code>grep -n text *
</code></pre>

<p>3) Search for all files containing &lsquo;text&rsquo; in current and sub directories.</p>

<pre><code>$ grep -R text *
</code></pre>

<p>4) Search for files containing &lsquo;text&rsquo; in word only mode (Perl regular expressions).</p>

<pre><code>$ grep -P '\btext\b' *
</code></pre>

<p>5) and remove &lsquo;//&rsquo; comments.</p>

<pre><code>$ grep -P '\btext\b' * | grep -v -P '://'
</code></pre>

<p>Remember for more info</p>

<pre><code>$ man grep
$ info grep
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/23/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/21/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/cooking'>Cooking (9)</a></li><li><a href='/blog/engineering'>Engineering (11)</a></li><li><a href='/blog/garden'>Garden (11)</a></li><li><a href='/blog/home'>Home (4)</a></li><li><a href='/blog/photography'>Photography (31)</a></li><li><a href='/blog/tech'>Tech (215)</a></li></ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/tech/edit-octopress-posts/">Edit Octopress Posts</a>
      </li>
    
      <li class="post">
        <a href="/blog/engineering/without-a-line-return/">$display Without a Line Return</a>
      </li>
    
      <li class="post">
        <a href="/blog/garden/rocket-and-chilli/">Rocket &amp; Chilli</a>
      </li>
    
      <li class="post">
        <a href="/blog/garden/spring/">Spring</a>
      </li>
    
      <li class="post">
        <a href="/blog/tech/gnome-disable-focus-tracking/">Gnome: Disable Focus Tracking</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/morganp">@morganp</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'morganp',
            count: 1,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Morgan Prior -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'morganpgithubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
