
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>RockPaperScissors</title>
  <meta name="author" content="Morgan Prior">

  
  <meta name="description" content="Since moving to Classy Sinatra applications I have not been able to get put and delete methods to work correctly. This is because sinatra/base does &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lizard-spock.co.uk/blog/page/24">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="RockPaperScissors" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet' type='text/css'>
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-47010631-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">RockPaperScissors</a></h1>
  
    <h2>LizardSpock</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:lizard-spock.co.uk" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Latest</a></li>
  <li><a href="/blog/archives">All</a></li>
  <li><a href="/tag">Tags</a></li>
  <li><a href="/license">License</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/put-methods-not-working-with-classy-sinatra-apps/">Put Methods Not Working with Classy Sinatra Apps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-11T05:38:06+00:00" pubdate data-updated="true">Dec 11<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/put-methods-not-working-with-classy-sinatra-apps/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/put-methods-not-working-with-classy-sinatra-apps/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since moving to Classy Sinatra applications I have not been able to get put and delete methods to work correctly. This is because sinatra/base does not include the rack method override &lsquo;stuff&rsquo;.</p>

<pre><code>require 'rubygems'
require 'sinatra/base'
module MyModule
  class MyApp &lt; Sinatra::Base
    use Rack::MethodOverride ##&lt;-- Required for put delete

    get '/' do
    '&lt;form method="post" action="/"&gt;' + 
    '  &lt;input  type="hidden" name="_method" value="put" /&gt;' +
    '  &lt;button type="submit"&gt; Test PUT&lt;/button&gt;&lt;br  /&gt;' +
    '&lt;/form&gt;'
    end

    put '/' do
      'PUT works'
    end
  end
end

if $0 == __FILE__
  MyModule::MyApp.run!
end
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/rake-aborted%21-undefined-method-%60info-for-nilnilclass/">Rake Aborted! Undefined Method `info&#8217; for nil:NilClass</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-04T11:24:05+00:00" pubdate data-updated="true">Nov 4<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/rake-aborted%21-undefined-method-%60info-for-nilnilclass/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/rake-aborted%21-undefined-method-%60info-for-nilnilclass/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am currently switching between runing migrations locally on an sqlite3 database and postgres for production on Heroku.</p>

<p>When switching back to a local sqlite3 I got this error when running the migration.</p>

<pre><code>$ rake db:migrate

(in /Users/path/to/top/level)
** Invoke db:migrate (first_time)
** Invoke environment (first_time)
** Execute environment
** Execute db:migrate
rake aborted!
undefined method `info' for nil:NilClass
</code></pre>

<p>The error I found through <a href="http://stackoverflow.com/questions/1719212/undefined-method-info-for-nilnilclass-when-running-active-record-migration">Stackoverflow</a> was that I had not defined a logger.</p>

<p>My rakefile.rb for sinatra applications to run activerecord migrations.</p>

<pre><code>require 'rubygems'
require 'rake'
require 'active_record'

namespace :db do
  desc "Migrate the database through scripts in db/migrate. Target specific version with VERSION=x"
  task :migrate =&gt; :environment do
    ActiveRecord::Migrator.migrate('db/migrate', ENV["VERSION"] ? ENV["VERSION"].to_i : nil )
  end
end

task :environment do
  ActiveRecord::Base.establish_connection(
    :adapter =&gt; 'sqlite3',
    :database =&gt; 'db/local.db'
  )
  ActiveRecord::Base.logger = Logger.new(File.open('database.log', 'a'))

 # ActiveRecord::Base.establish_connection(
 #     :adapter  =&gt; 'postgresql',
 #     :host     =&gt; 'host',
 #     :username =&gt; 'user',
 #     :password =&gt; 'pass',
 #     :database =&gt; 'db'
 # )

end
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/sinatra-heroku-and-configru/">Sinatra Heroku and config.ru</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-03T16:43:22+00:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2010</time>
        
           | <a href="/blog/tech/sinatra-heroku-and-configru/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/sinatra-heroku-and-configru/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rack applications often require a config.ru for deployment. The standard config.ru for classic sinatra applications is well documented:</p>

<pre><code>require 'app'
run Sinatra::Application
</code></pre>

<p>The requirments for classy apps is not very well documented, currently I use this on heroku:</p>

<pre><code>#For Ruby 1.8.7 (the 1.9.2 version should also work) on Heroku
require 'app'
run MyModule::MyApp
</code></pre>

<p>After trying Ruby 1.9.2 I had to add ./ to my app require. The current directory has been removed from the load path adding ./ removes the problem because it explicitly defines the path.</p>

<pre><code>#For Ruby 1.9.2 on Heroku
require './app'
run MyModule::MyApp
</code></pre>

<p>For a sinatra Application which may look like:</p>

<pre><code>require 'sinatra/base'
module MyModule
  class MyApp &lt; Sinatra::Base
    get '/' do
      'HelloWorld!'
    end
  end
end

#if file called directly launch app (ie ruby my_app.rb)
if $0 == __FILE__
  MyModule::MyApp.run!
end
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/sinatra-session-extension/">Sinatra Session Extension</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-02T12:49:03+00:00" pubdate data-updated="true">Nov 2<span>nd</span>, 2010</time>
        
           | <a href="/blog/tech/sinatra-session-extension/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/sinatra-session-extension/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have just started to use a <a href="http://www.sinatrarb.com/extensions.html">sinatra extensions</a> called <a href="http://mjijackson.com/sinatra-session/">Sinatra Session</a>. The write up on the <a href="http://mjijackson.com/sinatra-session/">main site</a> is pretty good and only include a short summary below.</p>

<pre><code>gem install sinatra-session
</code></pre>

<p>In your app (classy style)</p>

<pre><code>require 'sinatra/base'
require 'sinatra/session'

class MyApp &lt; Sinatra::Base
  register Sinatra::Session

  # Use helpers as required
  get '/' do
    session_start!
    session[:foo] ||= 'bar'

    #now view helper, etc, can call session[:foo] to get value 'bar'
  end

end
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/sinatra-reload-source-file-changes-in-development-mode/">Sinatra Reload Source File Changes in Development Mode</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-02T11:03:26+00:00" pubdate data-updated="true">Nov 2<span>nd</span>, 2010</time>
        
           | <a href="/blog/tech/sinatra-reload-source-file-changes-in-development-mode/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/sinatra-reload-source-file-changes-in-development-mode/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://github.com/rkh/sinatra-reloader">Sinatra Reloader</a> is a sinatra extension which reloads source files while in development mode, this functionality was removed from base sinatra in 0.9.2</p>

<pre><code>gem install sinatra-reloader
</code></pre>

<p>In your app (classy style)</p>

<pre><code>require "sinatra/base"
require "sinatra/reloader"

class Foo &lt; Sinatra::Base
  configure(:development) do
    register Sinatra::Reloader
    also_reload "models/*.rb"
    also_reload "helpers/*.rb"
    #dont_reload "lib/**/*.rb"
  end
end
</code></pre>

<p><a href="http://github.com/rkh/sinatra-reloader">Source</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/os-x-open-finder-from-command-line/">OS X Open Finder from Command Line</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-13T11:08:40+01:00" pubdate data-updated="true">Oct 13<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/os-x-open-finder-from-command-line/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/os-x-open-finder-from-command-line/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just discovered this: from <a href="http://grx.no/kb/2009/01/09/open-finder-for-current-directory-from-command-line/">source</a>.</p>

<pre><code>$ open .
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/stopstart-and-restart-samba-on-os-x/">Stop/Start and Restart Samba on OS X</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-10T10:13:52+01:00" pubdate data-updated="true">Oct 10<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/stopstart-and-restart-samba-on-os-x/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/stopstart-and-restart-samba-on-os-x/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>To Stop Start and Restart Samba on Mac OS X 10.6:</p>

<pre><code>sudo /usr/sbin/smbd stop
sudo /usr/sbin/smbd start
sudo /usr/sbin/smbd restart
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/photography/natural-hdr-images-in-lightroom/">Natural HDR Images in Lightroom</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-01T16:56:03+01:00" pubdate data-updated="true">Oct 1<span>st</span>, 2010</time>
        
           | <a href="/blog/photography/natural-hdr-images-in-lightroom/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/photography/natural-hdr-images-in-lightroom/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>NB: By default the image is only 500pixels on the long edge. By donating to the project you can remove this restriction.</p>

<p>This <a href="http://yanikphotoschool.com/tutorials/video_tutorials/creating-hdr-images-directly-in-lightroom-video-tutorial/">Video</a> demonstrates how to use the <a href="http://photographers-toolbox.com/products/lrenfuse.php">LR/Enfuse plugin</a>. Download the main application automatically from the plugin on <a href="http://enblend.sourceforge.net/">from here</a>.</p>

<p>Instruction is straightforward and if in doubt follow the <a href="http://yanikphotoschool.com/tutorials/video_tutorials/creating-hdr-images-directly-in-lightroom-video-tutorial/">Video</a>. Use is also covered on the <a href="http://blogs.oreilly.com/lightroom/2008/12/blend-with-lightroom-enfuse.html">Oreilly blog</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/ruby-each-or-delete_if/">Ruby Each or Delete_if</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-25T12:38:50+01:00" pubdate data-updated="true">Sep 25<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/ruby-each-or-delete_if/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/ruby-each-or-delete_if/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In ruby some times you want to iterate over an array and remove items that meet certain conditions, if using each the results may be unexpected.</p>

<pre><code>require 'pp'
arr = [1,2,3,4,5,6,7]
pp arr
# =&gt; [1, 2, 3, 4, 5, 6, 7, 8]

arr.each do |x|
   if x &gt; 3
      arr.delete( x )
   end
end
pp arr
# =&gt; [1, 2, 3, 5, 7]
</code></pre>

<p>5 and 7 were above 3 last time I checked, what is happening.<br/>
NB: ^ points to the current item of the iterator.</p>

<pre><code>#    [1,2,3,4,5,6,7,8]
#     ^                 -&gt; 1 fails x &gt; 3
#    [1,2,3,4,5,6,7,8]
#       ^               -&gt; 2 fails x &gt; 3
#    [1,2,3,4,5,6,7,8]
#         ^             -&gt; 3 fails x &gt; 3
#    [1,2,3,4,5,6,7,8]
#           ^           -&gt; 4 true  x &gt; 3, delete
#    [1,2,3,5,6,7,8]    -- Intermidiate Array, before each is incremented
#           ^
#    [1,2,3,5,6,7,8]    -- Number 5 has slipped through the evaluation
#             ^         -&gt; 6 true x &gt; 3, delete
#    [1,2,3,5,7,8]      -- Intermidiate Array
#             ^
#    [1,2,3,5,7,8]      -- Number 7 has slipped through
#               ^       -&gt; 8 true x &gt; 3, delete
#    return [1,2,3,5,7] #Not what we expected from the code.
</code></pre>

<p>Introducing <strong>delete_if</strong></p>

<pre><code>require 'pp'
arr = [1,2,3,4,5,6,7,8,9,10]

arr.delete_if do |x| 
   test = x &gt; 3

   # Do something when not being deleted
   if not test
      puts x
   end
   test
end
pp arr
# =&gt; [1, 2, 3]
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tech/storing-secret-keys-in-ruby-config-files-an-approach/">Storing Secret Keys in Ruby Config Files an Approach</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-11T19:04:53+01:00" pubdate data-updated="true">Sep 11<span>th</span>, 2010</time>
        
           | <a href="/blog/tech/storing-secret-keys-in-ruby-config-files-an-approach/#disqus_thread"
             data-disqus-identifier="http://lizard-spock.co.uk/blog/tech/storing-secret-keys-in-ruby-config-files-an-approach/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have for a while wondered about an ideal (good) approach to storing api keys in config files in ruby projects. A few conditions must be met:<br/>
1) A new user must be given clear instructions on what has to be configured (until it is done), with boiler plate to complete.<br/>
2) git must not accidentally let you submit the key.</p>

<p>Gregory Brown steered me towards this setup. Create a config.rb file fill out the template for adding data. Then copy it to config.rb.example and add config.rb to the .gitignore</p>

<pre><code>touch config.rb
#setup template of config.rb
cp config.rb config.rb.example
echo "config.rb" &gt;&gt; .gitignore
git add config.rb.example
</code></pre>

<p>The file requiring the keys can then do something like:</p>

<pre><code>begin
  require "config"
rescue LoadError
  STDERR.puts "You need to create a file called config.rb. See config.rb.example"
exit
</code></pre>

<p>A slightly larger example.<br/>
shorturl.rb</p>

<pre><code>  require 'net/http'
  require 'rubygems'
  require 'json'
  require 'cgi'

  begin 
     require File.dirname(__FILE__) + '/bit_ly_key'
  rescue LoadError
   STDERR.puts "You need to create a file called bit_ly_key.rb. See bit_ly_key.rb.example"
   exit
  end

  module TechNews
     class Shorturl
        def initialize( url=nil )
           bit_ly_keys = TechNews::BitLyKey.new

           ##  url encode
           url ||= "http://amaras-tech.co.uk"
           @long_url = CGI.escape( url )
           payload   = "http://api.bit.ly/v3/shorten?login=#{bit_ly_keys.login}&amp;apiKey=#{bit_ly_keys.apiKey}&amp;longUrl=#{@long_url}&amp;format=json"
           @response = Net::HTTP.get URI.parse(payload)
           @response = JSON.parse( @response )
        end

        def get_shorturl
           return @response["data"]["url"]
        end

     end
  end

  if $0 == __FILE__
     x = TechNews::Shorturl.new()
     puts x.get_shorturl
  end
</code></pre>

<p>bit_ly_key.rb</p>

<pre><code># Register at [1] and get api key [2]
# [1]: http://bit.ly
# [2]: http://bit.ly/a/your_api_key

module TechNews
   class BitLyKey
      attr_reader :login, :apiKey

      def initialize
         @login  = ""
         @apiKey = ""
      end

   end
end
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/25/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/23/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/cooking'>Cooking (11)</a></li><li><a href='/blog/engineering'>Engineering (19)</a></li><li><a href='/blog/garden'>Garden (14)</a></li><li><a href='/blog/home'>Home (4)</a></li><li><a href='/blog/photography'>Photography (32)</a></li><li><a href='/blog/tech'>Tech (229)</a></li></ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/tech/iterm-exit-fullscreen/">iTerm Exit Fullscreen</a>
      </li>
    
      <li class="post">
        <a href="/blog/tech/fixing-mangled-octopress-tags/">Fixing Mangled Octopress Tags</a>
      </li>
    
      <li class="post">
        <a href="/blog/tech/thor-variable-arguments/">Thor Variable Arguments</a>
      </li>
    
      <li class="post">
        <a href="/blog/tech/ruby-print-array/">Ruby Print Array</a>
      </li>
    
      <li class="post">
        <a href="/blog/tech/screen-scrollback/">Screen Scrollback</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/morganp">@morganp</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'morganp',
            count: 1,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Morgan Prior -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'morganpgithubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
