
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby Memory Issue on Web Faction - RockPaperScissors</title>
  <meta name="author" content="Morgan Prior">

  
  <meta name="description" content="I while ago I made a post about installing ruby 1.9 on my webfaction shared host. They then pointed out to me that if I had gone into my webapps/ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://morganp.github.io/blog/tech/ruby-memory-issue-on-web-faction">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="RockPaperScissors" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet' type='text/css'>
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-47010631-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">RockPaperScissors</a></h1>
  
    <h2>LizardSpock</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:morganp.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Latest</a></li>
  <li><a href="/blog/archives">All</a></li>
  <li><a href="/tag">Tags</a></li>
  <li><a href="/license">License</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Ruby Memory Issue on Web Faction</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-03T13:19:02+01:00" pubdate data-updated="true">May 3<span>rd</span>, 2010</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://morganp.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I while ago I made <a href="http://amaras-tech.co.uk/people/morgan/article/14">a post</a> about installing ruby 1.9 on my webfaction shared host. They then pointed out to me that if I had gone into my webapps/passanger/bin folder I would have seen that it does not use the ruby and gems on my default path but is free to point to a different version.</p>

<p>Lately I have been having some memory issue with my ruby sinatra apps. This site normally idles under 20MB but when hit with multiple visitors peaks at over 190MB which is way outside of my allowed usage (80MB), Webfaction have been very good in giving me some lee-way until I have resolved the issue.</p>

<p>From reading <a href="http://www.modrails.com/documentation/Architectural%20overview.html">this article on passenger architecture</a> I have discovered that standard ruby (1.8 and 1.9) do not work that well with passengers spawning processors and the <a href="http://www.rubyenterpriseedition.com/">Ruby Enterprise</a> is recommended. Ruby Enterprise 1.8 is standard with webfaction. I have therefore reverted back to the standard.</p>

<p>I have got a <a href="http://github.com/morganp/munkymorgy_scripts_generic/blob/master/memory_usage.rb">small ruby script</a> on github which can be used to monitor memory usage. It has been moded from the original <a href="http://gist.github.com/290988">gist</a> I found it on to allow it to run on Mac OS X. NB: the script uses around 3MB of memory to run.</p>

<p><a href="http://adamblog.heroku.com/past/2008/6/10/sinatra_my_new_favorite_microframework/">This blog post</a> gives a good overview of the memory footprints of different ruby web frameworks. NB: On my development machine I have noted that ruby 1.8 took 22MB to run my app but increased quickly to 30MB when serving pages and ruby 1.9 took 45MB but did not increase as sharply while serving pages.</p>

<p>Update:
This post has served as a test with Ruby Enterprise. I now when posting (assuming from the twitter feed) i get a few hits, which cause 5 Rack processes to be spawned all taking 25MB. This is still not ideal but is slightly more controlled than ruby 1.9. when restarting the server it drops back down to 18MB (no rack process) which suggests all the traffic was in a very short space of time and that the rack processes would have been closed as they timed out, they stay open for a while so to avoid delay when being hit by frequent requests.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Morgan Prior</span></span>

      








  


<time datetime="2010-05-03T13:19:02+01:00" pubdate data-updated="true">May 3<span>rd</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/tech/'>Tech</a>
  
</span>


      

<span class="tags">
  
    <a class='tag' href='/tag/performance/'>Performance</a>, <a class='tag' href='/tag/programming/'>Programming</a>, <a class='tag' href='/tag/ruby/'>Ruby</a>, <a class='tag' href='/tag/sinatra/'>Sinatra</a>, <a class='tag' href='/tag/webfaction/'>WebFaction</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://morganp.github.io/blog/tech/ruby-memory-issue-on-web-faction/" data-via="" data-counturl="http://morganp.github.io/blog/tech/ruby-memory-issue-on-web-faction/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/engineering/matlab-scripting-axes-properties/" title="Previous Post: Matlab Scripting Axes Properties">&laquo; Matlab Scripting Axes Properties</a>
      
      
        <a class="basic-alignment right" href="/blog/tech/installing-ruby-enterprise-on-mac-os-x/" title="Next Post: Installing Ruby Enterprise on Mac OS X">Installing Ruby Enterprise on Mac OS X &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/cooking'>Cooking (9)</a></li><li><a href='/blog/engineering'>Engineering (9)</a></li><li><a href='/blog/garden'>Garden (7)</a></li><li><a href='/blog/home'>Home (4)</a></li><li><a href='/blog/photography'>Photography (31)</a></li><li><a href='/blog/tech'>Tech (211)</a></li></ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/garden/raised-bed/">Raised Bed</a>
      </li>
    
      <li class="post">
        <a href="/blog/cooking/beef-wellington/">Beef Wellington</a>
      </li>
    
      <li class="post">
        <a href="/blog/engineering/matlab-legend-colours/">Matlab: Legend Colours</a>
      </li>
    
      <li class="post">
        <a href="/blog/home/cooking-le-crueset-sizes/">Kitchen: Le Creuset</a>
      </li>
    
      <li class="post">
        <a href="/blog/engineering/matlab-benchmarking/">Matlab Benchmarking</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/morganp">@morganp</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'morganp',
            count: 1,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Morgan Prior -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'morganpgithubio';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://morganp.github.io/blog/tech/ruby-memory-issue-on-web-faction/';
        var disqus_url = 'http://morganp.github.io/blog/tech/ruby-memory-issue-on-web-faction/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
